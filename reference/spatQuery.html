<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spatial Query — spatQuery • GiottoClass</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Query — spatQuery"><meta name="description" content="Select spatial geometries based on a list of spatial filters.
The final item in provided in the list is the layer of information
being queried.
By default, results will be returned as a new polygon-based spatial unit
with selection information recorded in the associated cell metadata.
Spatial queries may perform queries on the geometries themselves, so
intersect() operations are performed under the hood. For a lighter weight
option that just finds spatial relationships, see relate()"><meta property="og:description" content="Select spatial geometries based on a list of spatial filters.
The final item in provided in the list is the layer of information
being queried.
By default, results will be returned as a new polygon-based spatial unit
with selection information recorded in the associated cell metadata.
Spatial queries may perform queries on the geometries themselves, so
intersect() operations are performed under the hood. For a lighter weight
option that just finds spatial relationships, see relate()"><meta property="og:image" content="https://drieslab.github.io/GiottoClass/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GiottoClass</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Documentation</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/spatial_geometries.html">Spatial Geometry Objects</a></li>
    <li><a class="dropdown-item" href="../articles/image_tools.html">Images</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://drieslab.github.io/Giotto/">Suite</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/drieslab/GiottoClass/" aria-label="github"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spatial Query</h1>
      <small class="dont-index">Source: <a href="https://github.com/drieslab/Giotto/blob/website/R/spatial_query.R" class="external-link"><code>R/spatial_query.R</code></a></small>
      <div class="d-none name"><code>spatQuery.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Select spatial geometries based on a list of spatial <code>filters</code>.
The final item in provided in the list is the layer of information
being queried.<br>
By default, results will be returned as a new polygon-based spatial unit
with selection information recorded in the associated cell metadata. <br>
Spatial queries may perform queries on the geometries themselves, so
<code><a href="spatial_binary_ops.html">intersect()</a></code> operations are performed under the hood. For a lighter weight
option that just finds spatial relationships, see <code><a href="relate.html">relate()</a></code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spatQuery</span><span class="op">(</span></span>
<span>  <span class="va">gobject</span>,</span>
<span>  <span class="va">filters</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"query_polys"</span>,</span>
<span>  clip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_centroids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  make_valid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  combine_fragments <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dissolve <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_table <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_ids <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_gobject <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">spatQueryGiottoPolygons</span><span class="op">(</span></span>
<span>  <span class="va">gobject</span>,</span>
<span>  <span class="va">filters</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"query_polys"</span>,</span>
<span>  clip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_centroids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  make_valid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  combine_fragments <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dissolve <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_table <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_ids <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_gobject <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-gobject">gobject<a class="anchor" aria-label="anchor" href="#arg-gobject"></a></dt>
<dd><p><code>giotto</code> object</p></dd>


<dt id="arg-filters">filters<a class="anchor" aria-label="anchor" href="#arg-filters"></a></dt>
<dd><p>named list of characters and/or <code>giottoPolygons</code> to use as
spatial filters for the final item in the list.</p><ul><li><p>[<code>character</code>] list name designates the gobject spatial unit to use as a
filter. The actual character values should either be <code>"all"</code> or a specific
vector of cell_IDs to use.</p></li>
<li><p>[<code>giottoPolygon</code>] inputs are directly used as filters. List names are
used when reporting the spatial relationships in output geometry objects.
These can also be used as centroids and additionally can be buffered.</p></li>
<li><p>[<code>SpatVector</code>] inputs are directly used. Can also be converted to
centroids and/or buffered.</p></li>
<li><p>[<code>numeric</code>] input is read as XY pairs (e.g. <code>c(x1, y1, x2, y2, ...)</code>),
to be used as centroids. These are bufferable.</p></li>
<li><p>['spatLocsObj'] inputs are directly used as centroids. These are
bufferable.</p></li>
</ul></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>(optional) character. If not <code>NULL</code>, a new spatial unit of this
name will be generated from the results.</p></dd>


<dt id="arg-clip">clip<a class="anchor" aria-label="anchor" href="#arg-clip"></a></dt>
<dd><p>logical. Default = <code>TRUE</code>. Whether final round of querying should
produce polygons clipped by the polygons used to select them.</p></dd>


<dt id="arg-use-centroids">use_centroids<a class="anchor" aria-label="anchor" href="#arg-use-centroids"></a></dt>
<dd><p>character vector. Values must correspond to names in
<code>filters</code>. Selected <code>filters</code> will be converted to centroids. (prefers
usage of the first set of spatlocs for that spat_unit)</p></dd>


<dt id="arg-buffer">buffer<a class="anchor" aria-label="anchor" href="#arg-buffer"></a></dt>
<dd><p>numeric. Or named vector of numerics. Names must correspond to
those in <code>centroids</code>. Applies the specified buffer to the centroid to allow
it to be used in <code>filter</code>. A <code>0</code> will skip buffering, but this is only
permitted if is also the the last item in <code>filter</code>. Unbuffered points may
only return results as IDs (<code>return_ids = TRUE</code>). Do note that buffering on
a large number of elements can cause significant slowdowns.</p></dd>


<dt id="arg-make-valid">make_valid<a class="anchor" aria-label="anchor" href="#arg-make-valid"></a></dt>
<dd><p>logical (default = <code>FALSE</code>). Whether to make geometries
valid before using them. Set <code>TRUE</code> if topology errors show up.</p></dd>


<dt id="arg-combine-fragments">combine_fragments<a class="anchor" aria-label="anchor" href="#arg-combine-fragments"></a></dt>
<dd><p>logical. (default = <code>FALSE</code>). Whether to combine
geoms fragmented by the intersections as multipolygons based on the
<code>poly_ID</code> col. If <code>TRUE</code>, the operation may introduce <code>NA</code>s in the spatial
relationship information.</p></dd>


<dt id="arg-dissolve">dissolve<a class="anchor" aria-label="anchor" href="#arg-dissolve"></a></dt>
<dd><p>logical. (default = <code>FALSE</code>). If <code>combine_fragments = TRUE</code>,
whether to also merge the multipolygon into a single polygon.</p></dd>


<dt id="arg-return-table">return_table<a class="anchor" aria-label="anchor" href="#arg-return-table"></a></dt>
<dd><p>logical. (Default = <code>FALSE</code>) Overrides <code>return__object</code>.
If <code>TRUE</code>, return only the relationships as a <code>data.table</code></p></dd>


<dt id="arg-return-ids">return_ids<a class="anchor" aria-label="anchor" href="#arg-return-ids"></a></dt>
<dd><p>logical. (Default = <code>FALSE</code>) Overrides <code>return_gobject</code>.
If <code>TRUE</code>, return only the poly_IDs of the final entry in <code>filters</code></p></dd>


<dt id="arg-return-gobject">return_gobject<a class="anchor" aria-label="anchor" href="#arg-return-gobject"></a></dt>
<dd><p>logical. (Default = <code>TRUE)</code>. Whether to return the new
set of polygons attached to the giotto object.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>verbosity</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>character</code> (IDs), <code>giottoPolygon</code>, or <code>giotto</code> depending on
<code>return_ids</code> and <code>return_gobject</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>spatQueryGiottoPolygons()</code>: deprecated alias.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="relate.html">relate()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">GiottoData</span><span class="fu">::</span><span class="fu"><a href="https://drieslab.github.io/GiottoData/reference/loadGiottoMini.html" class="external-link">loadGiottoMini</a></span><span class="op">(</span><span class="st">"vizgen"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1. read Giotto object</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2. read Giotto feature information</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3. read Giotto spatial information</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3.1 read Giotto spatial shape information</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3.2 read Giotto spatial centroid information</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3.3 read Giotto spatial overlap information</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 4. read Giotto image information</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> python already initialized in this session</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  active environment : 'giotto_env'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  python version : 3.10</span>
<span class="r-in"><span><span class="va">pz0</span> <span class="op">&lt;-</span> <span class="fu"><a href="getPolygonInfo.html">getPolygonInfo</a></span><span class="op">(</span><span class="va">g</span>, <span class="st">"z0"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">boxgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="tessellate.html">tessellate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    extent <span class="op">=</span> <span class="fu"><a href="ext.html">ext</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    shape <span class="op">=</span> <span class="st">"square"</span>,</span></span>
<span class="r-in"><span>    shape_size <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>    name <span class="op">=</span> <span class="st">"boxgrid"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 90 polygons generated</span>
<span class="r-in"><span><span class="va">hexarray</span> <span class="op">&lt;-</span> <span class="fu"><a href="tessellate.html">tessellate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    extent <span class="op">=</span> <span class="fu"><a href="ext.html">ext</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    shape <span class="op">=</span> <span class="st">"hexagon"</span>,</span></span>
<span class="r-in"><span>    shape_size <span class="op">=</span> <span class="fl">80</span>,</span></span>
<span class="r-in"><span>    name <span class="op">=</span> <span class="st">"hexarray"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 33 polygons generated</span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="setGiotto.html">setGiotto</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">boxgrid</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting polygon info [boxgrid]</span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="setGiotto.html">setGiotto</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">hexarray</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting polygon info [hexarray]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">hex_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ID_%d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">17</span>, <span class="fl">19</span>, <span class="fl">23</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">box_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ID_%d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">22</span>, <span class="fl">41</span>, <span class="fl">44</span>, <span class="fl">45</span>, <span class="fl">51</span>, <span class="fl">52</span>, <span class="fl">62</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">spatQuery</span><span class="op">(</span><span class="va">g</span>,</span></span>
<span class="r-in"><span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        hexarray <span class="op">=</span> <span class="va">hex_ids</span>,</span></span>
<span class="r-in"><span>        boxgrid <span class="op">=</span> <span class="va">box_ids</span>,</span></span>
<span class="r-in"><span>        z0 <span class="op">=</span> <span class="st">"all"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    return_gobject <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [hexarray] vs [boxgrid]...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [boxgrid] vs [z0]...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting polygon info [query_polys]</span>
<span class="r-in"><span><span class="co"># extract polys since we attached it to the giotto object</span></span></span>
<span class="r-in"><span><span class="va">qp</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">[[</span>, <span class="st">"query_polys"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">qp2</span> <span class="op">&lt;-</span> <span class="fu">spatQuery</span><span class="op">(</span><span class="va">g</span>,</span></span>
<span class="r-in"><span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        hexarray <span class="op">=</span> <span class="va">hex_ids</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>        boxgrid <span class="op">=</span> <span class="va">box_ids</span>,</span></span>
<span class="r-in"><span>        z0 <span class="op">=</span> <span class="st">"all"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    buffer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>hexarray <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    return_gobject <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [hexarray] vs [boxgrid]...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [boxgrid] vs [z0]...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check that extracted polys are being clipped as expected</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">pz0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">hexarray</span><span class="op">[</span><span class="va">hex_ids</span><span class="op">]</span>, border <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">boxgrid</span><span class="op">[</span><span class="va">box_ids</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, border <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">qp</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># selection by hex and box</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="fu"><a href="buffer.html">buffer</a></span><span class="op">(</span><span class="va">hexarray</span><span class="op">[</span><span class="va">hex_ids</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, width <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># buffered hex</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">qp2</span>, col <span class="op">=</span> <span class="st">"black"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># selection by buffered hex and box</span></span></span>
<span class="r-plt img"><img src="spatQuery-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># query for polys that fall within 100 units of a point</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">spatQuery</span><span class="op">(</span><span class="va">g</span>,</span></span>
<span class="r-in"><span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        pts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6500</span>, <span class="op">-</span><span class="fl">4900</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        z0 <span class="op">=</span> <span class="st">"all"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    buffer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    return_gobject <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    make_valid <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    clip <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [pts] vs [z0]...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pt_buffer</span> <span class="op">&lt;-</span> <span class="fu"><a href="buffer.html">buffer</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="as.points.html">as.points</a></span><span class="op">(</span><span class="fu"><a href="createSpatLocsObj.html">createSpatLocsObj</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6500</span>, <span class="op">-</span><span class="fl">4900</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">pz0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">pt_buffer</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, border <span class="op">=</span> <span class="st">"dodgerblue"</span><span class="op">)</span> <span class="co"># the selecting shape.</span></span></span>
<span class="r-in"><span><span class="co"># note that clip = FALSE for this selection</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-generic.html">plot</a></span><span class="op">(</span><span class="va">res</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="spatQuery-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only return the ids</span></span></span>
<span class="r-in"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu">spatQuery</span><span class="op">(</span><span class="va">g</span>,</span></span>
<span class="r-in"><span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        pts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6500</span>, <span class="op">-</span><span class="fl">4900</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        z0 <span class="op">=</span> <span class="st">"all"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    buffer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    return_ids <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    make_valid <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [pts] vs [z0]...</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "283905456529622685341101046014233199432"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "123860671559578247432410194986927758864"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "152684748256642370929802439227360458069"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "134398773695365619188678200952912609063"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "186988931894710833920932112634285943415"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "334199301045926627171760429217123408914"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 73</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only return the table of relations</span></span></span>
<span class="r-in"><span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu">spatQuery</span><span class="op">(</span><span class="va">g</span>,</span></span>
<span class="r-in"><span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        hexarray <span class="op">=</span> <span class="va">hex_ids</span>,</span></span>
<span class="r-in"><span>        boxgrid <span class="op">=</span> <span class="va">box_ids</span>,</span></span>
<span class="r-in"><span>        z0 <span class="op">=</span> <span class="st">"all"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    return_table <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    make_valid <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [hexarray] vs [boxgrid]...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> processing [boxgrid] vs [z0]...</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/force.html" class="external-link">force</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                     poly_ID hexarray boxgrid</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      &lt;char&gt;   &lt;char&gt;  &lt;char&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 251905496166492083168644493421091558216     ID_3   ID_15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 115370283894795045523368609208878185314     ID_3   ID_15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 313341882093478712453835418083823400203     ID_3   ID_16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 165786478473465185470745991122188406667     ID_6   ID_12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 176844289786228093052039491926955764947     ID_6   ID_12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 176844289786228093052039491926955764947     ID_6   ID_22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 262996653580953175020435707363716649390     ID_6   ID_22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 153751792203577791006158581642177087065     ID_6   ID_22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:  48024672048124996997588408479044670509     ID_6   ID_22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:  15242486364109501724975900940581726845     ID_6   ID_22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:  51755314931016750193347838201084403236     ID_8   ID_14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:  20548793658722995878220914240286086757     ID_8   ID_14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: 182235958169292445695483205478317795477     ID_8   ID_14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: 230344318208995342827768566280706457626     ID_8   ID_14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: 115370283894795045523368609208878185314     ID_8   ID_15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:  36648998424868029072860674954666559763    ID_17   ID_41</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:  39033692777509843205319060807429911979    ID_17   ID_41</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: 278393157796816366316911857085286324582    ID_17   ID_51</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:  87260224659312905497866017323180367450    ID_17   ID_51</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20: 150082699777048696177232440639953146354    ID_17   ID_52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: 101161259912191124732236989250178928032    ID_17   ID_52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: 110900719814678261966908552089216814729    ID_19   ID_44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:  64228015236811922665804882776457047292    ID_19   ID_44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: 291975341311453330406711526698967834209    ID_19   ID_44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:  15834776842182822801451197571763335013    ID_19   ID_44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:   3942785923272820952395109293003259310    ID_19   ID_45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:  87260224659312905497866017323180367450    ID_23   ID_51</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28: 101161259912191124732236989250178928032    ID_23   ID_52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29: 224458376429228506642398057779371677646    ID_23   ID_52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30: 306415949245581212081161219410047325001    ID_23   ID_62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31:  68418314542386876178693610244900595267    ID_23   ID_62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32:  47275912178029130797780898068213599096    ID_23   ID_62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33:  62669443199671326763841071380380779477    ID_23   ID_62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                     poly_ID hexarray boxgrid</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.drieslab.com" class="external-link">Ruben Dries</a>, <a href="https://github.com/jiajic" class="external-link">Jiaji George Chen</a>, <a href="https://labs.icahn.mssm.edu/yuanlab/" class="external-link">Guo-Cheng Yuan</a>, Matthew O’Brien, <a href="https://josschavezf.github.io" class="external-link">Joselyn C. Chávez-Fuentes</a>, Edward Ruiz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

