<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GiottoClass">
<title>Giotto spatial geometry classes • GiottoClass</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/JetBrains_Mono-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Giotto spatial geometry classes">
<meta property="og:description" content="GiottoClass">
<meta property="og:image" content="https://drieslab.github.io/GiottoClass/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GiottoClass</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Documentation</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/spatial_geometries.html">Spatial Geometry Objects</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/drieslab/GiottoClass/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Giotto spatial geometry classes</h1>
            
      
      
      <div class="d-none name"><code>spatial_geometries.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">1. Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><em>GiottoClass</em> represents spatial polygons and points
respectively as S4 classes <code>giottoPolygon</code> and
<code>giottoPoints</code>. These objects are built on top of
<em>terra</em> <code>SpatVectors</code> in order to represent spatial
biology. They also respond to many of terra’s generics, with some
enhancements. Both objects have a <code>spatVector</code> slot that
contains the main information. This common slot is inherited from the
<code>VIRTUAL</code> <code>terraVectData</code> class, however this
naming may be subject to change as other data representations are
added.</p>
<p>The structures of these classes are:</p>
<pre><code>terraVectData
\- spatVector

giottoPolygon
\- spatVector           (spatial polygons SpatVector)
\- spatVectorCentroids  (centroids points SpatVector)
\- overlaps             (list of overlapped features info)
\- name                 (object name/spat_unit)
\- unique_ID_cache      (cache of polygon IDs)

giottoPoints
\- spatVector           (spatial points SpatVector)
\- networks             (feature network)
\- feat_type            (object name/feat_type)
\- unique_ID_cache      (cache of feature IDs)</code></pre>
<p>Of note are the <code>unique_ID_cache</code> slots which are used to
get around the memory usage incurred when frequently accessing the
<code>SpatVectors</code> attributes. The caches should be updated after
modifications to the object. This is automatically performed when using
<code>[]</code> subsetting.</p>
</div>
<div class="section level2">
<h2 id="polygon-object-creation">2.1 Polygon object creation<a class="anchor" aria-label="anchor" href="#polygon-object-creation"></a>
</h2>
<p><code><a href="../reference/createGiottoPolygon.html">createGiottoPolygon()</a></code> accepts a number of inputs,
including filepaths to spatial files such as .wkt, .shp, or .GeoJSON or
mask image files of common formats such as .tif or .png. After reading
in these files, they are passed to the respective methods for
<code>SpatVector</code> and <code>SpatRaster</code> (mask image).</p>
<p><code>data.frame-like</code> inputs are also allowed as long as they
are formatted similarly to <em>terra’s</em> <code>matrix</code>
representation of polygon geometries, with at least the following
columns.</p>
<ul>
<li>
<code>geom</code>: integer identifier for each polygon</li>
<li>
<code>part</code>: integer identifier for each part of the polygon,
in the case of a multi polygon</li>
<li>
<code>x</code>: numeric x coordinate of a polygon vertex</li>
<li>
<code>y</code>: numeric y coordinate of a polygon vertex</li>
<li>
<code>hole</code>: integer identifier for each hole within a
polygon</li>
<li>
<code>poly_ID</code>: standard Giotto identifier for the polygon.
Akin to cell_ID</li>
</ul>
<p>Additional columns can be included as other attributes, but a set of
<code>poly_ID</code>s are required.</p>
<p><em>For de-novo generation of simple polygon arrays, see the
documentation for <code><a href="../reference/polyStamp.html">polyStamp()</a></code> and
<code><a href="../reference/tessellate.html">tessellate()</a></code></em></p>
</div>
<div class="section level2">
<h2 id="points-object-creation">2.2 Points object creation<a class="anchor" aria-label="anchor" href="#points-object-creation"></a>
</h2>
<p>There are relatively fewer input methods for
<code>giottoPoints</code> since they currently tend to be provided as
flat files as opposed to spatial-specific formats.
<code><a href="../reference/createGiottoPoints.html">createGiottoPoints()</a></code> works with with
<code>data.frame-like</code> inputs with at least columns for
x-coordinate, y-coordinate, and ID information. The first two detected
numeric columns are expected to be x and y respectively. The first
character column is assumed to be the feat_IDs. <em>terra</em>
<code>SpatVector</code> inputs are also accepted.</p>
<p>A helpful parameter is <code>split_keyword</code> which accepts a
list of regex keywords to pull matched features into separate
<code>giottoPoints</code> objects. This is useful in situations where
multiple feature modalities and/or QC targets are provided together and
would interfere with each other if analyzed together. (see examples in
<code><a href="../reference/createGiottoPoints.html">createGiottoPoints()</a></code> documentation)</p>
</div>
<div class="section level2">
<h2 id="subsetting">3. Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h2>
<p><code>giottoPoints</code> and <code>giottoPolygons</code> can be
subset either by logical vectors or by ID.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://drieslab.github.io/GiottoClass/">GiottoClass</a></span><span class="op">)</span></span>
<span><span class="va">gpoly</span> <span class="op">&lt;-</span> <span class="fu">GiottoData</span><span class="fu">::</span><span class="fu"><a href="https://drieslab.github.io/GiottoData/reference/loadSubObjectMini.html" class="external-link">loadSubObjectMini</a></span><span class="op">(</span><span class="st">"giottoPolygon"</span><span class="op">)</span></span>
<span><span class="va">gpoints</span> <span class="op">&lt;-</span> <span class="fu">GiottoData</span><span class="fu">::</span><span class="fu"><a href="https://drieslab.github.io/GiottoData/reference/loadSubObjectMini.html" class="external-link">loadSubObjectMini</a></span><span class="op">(</span><span class="st">"giottoPoints"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># full objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class giottoPolygon</span></span>
<span><span class="co">## spat_unit : "aggregate"</span></span>
<span><span class="co">## Spatial Information:</span></span>
<span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : polygons </span></span>
<span><span class="co">##  dimensions  : 462, 4  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 6391.466, 6903.573, -5153.897, -4694.868  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  coord. ref. :  </span></span>
<span><span class="co">##  names       :                   poly_ID stack agg_n valid</span></span>
<span><span class="co">##  type        :                     &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">##  values      : 100210519278873141813371~    NA     2     1</span></span>
<span><span class="co">##                101161259912191124732236~    NA     2     1</span></span>
<span><span class="co">##                101488859781016188084173~    NA     2     1</span></span>
<span><span class="co">##  centroids   : calculated</span></span>
<span><span class="co">##  overlaps    : calculated</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoints</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class giottoPoints</span></span>
<span><span class="co">## feat_type : "rna"</span></span>
<span><span class="co">## Feature Information:</span></span>
<span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : points </span></span>
<span><span class="co">##  dimensions  : 79761, 3  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 6400.037, 6900.032, -5149.983, -4699.979  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  coord. ref. :  </span></span>
<span><span class="co">##  names       : feat_ID global_z feat_ID_uniq</span></span>
<span><span class="co">##  type        :   &lt;chr&gt;    &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">##  values      :    Mlc1        0            1</span></span>
<span><span class="co">##                 Gprc5b        0            2</span></span>
<span><span class="co">##                   Gfap        0            3</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subsets</span></span>
<span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_geometries_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"100210519278873141813371229408401071444"</span>, <span class="st">"101161259912191124732236989250178928032"</span>, <span class="st">"101488859781016188084173008420811094152"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_geometries_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"100210519278873141813371229408401071444"</span>, <span class="st">"101161259912191124732236989250178928032"</span>, <span class="st">"101488859781016188084173008420811094152"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class giottoPolygon</span></span>
<span><span class="co">## spat_unit : "aggregate"</span></span>
<span><span class="co">## Spatial Information:</span></span>
<span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : polygons </span></span>
<span><span class="co">##  dimensions  : 3, 4  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 6463.427, 6806.944, -5146.466, -4876.088  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  coord. ref. :  </span></span>
<span><span class="co">##  names       :                   poly_ID stack agg_n valid</span></span>
<span><span class="co">##  type        :                     &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">##  values      : 100210519278873141813371~    NA     2     1</span></span>
<span><span class="co">##                101161259912191124732236~    NA     2     1</span></span>
<span><span class="co">##                101488859781016188084173~    NA     2     1</span></span>
<span><span class="co">##  centroids   : calculated</span></span>
<span><span class="co">##  overlaps    : calculated</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">T</span>,<span class="cn">F</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_geometries_files/figure-html/unnamed-chunk-1-3.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gpoints</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_geometries_files/figure-html/unnamed-chunk-1-4.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gpoints</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fn1"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_geometries_files/figure-html/unnamed-chunk-1-5.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoints</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fn1"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class giottoPoints</span></span>
<span><span class="co">## feat_type : "rna"</span></span>
<span><span class="co">## Feature Information:</span></span>
<span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : points </span></span>
<span><span class="co">##  dimensions  : 814, 3  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 6400.663, 6884.093, -5149.767, -4711.758  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  coord. ref. :  </span></span>
<span><span class="co">##  names       : feat_ID global_z feat_ID_uniq</span></span>
<span><span class="co">##  type        :   &lt;chr&gt;    &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">##  values      :     Fn1        0          166</span></span>
<span><span class="co">##                    Fn1        0          181</span></span>
<span><span class="co">##                    Fn1        0          195</span></span></code></pre>
<p><code>$</code> extraction can be used to pull attributes of these
objects as vectors</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">$</span><span class="va">poly_ID</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "100210519278873141813371229408401071444"</span></span>
<span><span class="co">## [2] "101161259912191124732236989250178928032"</span></span>
<span><span class="co">## [3] "101488859781016188084173008420811094152"</span></span>
<span><span class="co">## [4] "101523780333017320796881555775415156847"</span></span>
<span><span class="co">## [5] "102184699197574201819246996094734116255"</span></span>
<span><span class="co">## [6] "102893953956695364131894293580364005295"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="conversion-to-data-table">4. Conversion to data.table<a class="anchor" aria-label="anchor" href="#conversion-to-data-table"></a>
</h2>
<p><em>GiottoClass</em> has a set of functions for converting
<code>giottoPoints</code> and <code>giottoPolygon</code> objects between
spatial classes using <code><a href="../reference/r_spatial_conversions.html">as.sf()</a></code>, <code><a href="../reference/r_spatial_conversions.html">as.sp()</a></code>,
<code><a href="../reference/r_spatial_conversions.html">as.stars()</a></code>, and <code><a href="../reference/r_spatial_conversions.html">as.terra()</a></code>.
<em>terra</em>-based <code>giottoPoints</code> and
<code>giottoPolygon</code> objects can also be converted into
<code>data.table</code> for geometry manipulation. This method largely
piggybacks off <em>terra</em>’s <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> and adds
support for <code>geom = "XY"</code> for polygon geometry.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gpoly_dt</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">gpoly</span>, geom <span class="op">=</span> <span class="st">"XY"</span><span class="op">)</span></span>
<span><span class="va">gpoints_dt</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">gpoints</span>, geom <span class="op">=</span> <span class="st">"XY"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoly_dt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        geom part        x         y hole</span></span>
<span><span class="co">##     1:    1    1 6642.257 -5136.674    0</span></span>
<span><span class="co">##     2:    1    1 6642.711 -5137.020    0</span></span>
<span><span class="co">##     3:    1    1 6643.050 -5137.462    0</span></span>
<span><span class="co">##     4:    1    1 6643.310 -5137.956    0</span></span>
<span><span class="co">##     5:    1    1 6643.484 -5138.518    0</span></span>
<span><span class="co">##    ---                                  </span></span>
<span><span class="co">## 35971:  462    1 6788.764 -4942.998    0</span></span>
<span><span class="co">## 35972:  462    1 6788.905 -4942.999    0</span></span>
<span><span class="co">## 35973:  462    1 6789.575 -4942.999    0</span></span>
<span><span class="co">## 35974:  462    1 6789.576 -4943.000    0</span></span>
<span><span class="co">## 35975:  462    1 6789.695 -4943.000    0</span></span>
<span><span class="co">##                                        poly_ID stack agg_n valid</span></span>
<span><span class="co">##     1: 100210519278873141813371229408401071444  &lt;NA&gt;     2     1</span></span>
<span><span class="co">##     2: 100210519278873141813371229408401071444  &lt;NA&gt;     2     1</span></span>
<span><span class="co">##     3: 100210519278873141813371229408401071444  &lt;NA&gt;     2     1</span></span>
<span><span class="co">##     4: 100210519278873141813371229408401071444  &lt;NA&gt;     2     1</span></span>
<span><span class="co">##     5: 100210519278873141813371229408401071444  &lt;NA&gt;     2     1</span></span>
<span><span class="co">##    ---                                                          </span></span>
<span><span class="co">## 35971:  98561957902191275233320065611022298397  &lt;NA&gt;     2     1</span></span>
<span><span class="co">## 35972:  98561957902191275233320065611022298397  &lt;NA&gt;     2     1</span></span>
<span><span class="co">## 35973:  98561957902191275233320065611022298397  &lt;NA&gt;     2     1</span></span>
<span><span class="co">## 35974:  98561957902191275233320065611022298397  &lt;NA&gt;     2     1</span></span>
<span><span class="co">## 35975:  98561957902191275233320065611022298397  &lt;NA&gt;     2     1</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoints_dt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          feat_ID global_z feat_ID_uniq        x         y</span></span>
<span><span class="co">##     1:      Mlc1        0            1 6400.037 -4966.651</span></span>
<span><span class="co">##     2:    Gprc5b        0            2 6400.041 -4965.377</span></span>
<span><span class="co">##     3:      Gfap        0            3 6400.078 -5081.453</span></span>
<span><span class="co">##     4:      Gfap        0            4 6400.084 -5038.288</span></span>
<span><span class="co">##     5:     Ednrb        0            5 6400.172 -4816.516</span></span>
<span><span class="co">##    ---                                                   </span></span>
<span><span class="co">## 79757:    Adgra1        1        80339 6900.010 -4773.595</span></span>
<span><span class="co">## 79758:     Cspg5        1        80340 6900.023 -4772.980</span></span>
<span><span class="co">## 79759: Adcyap1r1        1        80341 6900.024 -5007.432</span></span>
<span><span class="co">## 79760:   Slc17a7        1        80342 6900.026 -4924.840</span></span>
<span><span class="co">## 79761:     Cldn5        1        80343 6900.030 -4746.916</span></span></code></pre>
<p>These tables can then be either re-ingested using
<code><a href="../reference/createGiottoPolygon.html">createGiottoPolygon()</a></code> and <code><a href="../reference/createGiottoPoints.html">createGiottoPoints()</a></code>
or converted to <code>SpatVector</code> using <code><a href="../reference/as.polygons.html">as.polygons()</a></code>
or <code><a href="../reference/as.points.html">as.points()</a></code></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/as.polygons.html">as.polygons</a></span><span class="op">(</span><span class="va">gpoly_dt</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : polygons </span></span>
<span><span class="co">##  dimensions  : 462, 4  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 6391.466, 6903.573, -5153.897, -4694.868  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  coord. ref. :  </span></span>
<span><span class="co">##  names       :                   poly_ID stack agg_n valid</span></span>
<span><span class="co">##  type        :                     &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">##  values      : 100210519278873141813371~    NA     2     1</span></span>
<span><span class="co">##                101161259912191124732236~    NA     2     1</span></span>
<span><span class="co">##                101488859781016188084173~    NA     2     1</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gpoints currently still requires addition of geom, part, and hole cols</span></span>
<span><span class="va">gpoints_dt</span><span class="op">[</span>, <span class="va">geom</span> <span class="op">:=</span> <span class="fl">1</span><span class="op">:</span><span class="va">.N</span><span class="op">]</span></span>
<span><span class="va">gpoints_dt</span><span class="op">[</span>, <span class="va">part</span> <span class="op">:=</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">gpoints_dt</span><span class="op">[</span>, <span class="va">hole</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/as.points.html">as.points</a></span><span class="op">(</span><span class="va">gpoints_dt</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : points </span></span>
<span><span class="co">##  dimensions  : 79761, 3  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 6400.037, 6900.032, -5149.983, -4699.979  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  coord. ref. :  </span></span>
<span><span class="co">##  names       : feat_ID global_z feat_ID_uniq</span></span>
<span><span class="co">##  type        :   &lt;chr&gt;    &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">##  values      :    Mlc1        0            1</span></span>
<span><span class="co">##                 Gprc5b        0            2</span></span>
<span><span class="co">##                   Gfap        0            3</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="centroids">5. Centroids<a class="anchor" aria-label="anchor" href="#centroids"></a>
</h2>
<p>Centroids information are carried by <code>giottoPolygon</code>
objects in the <code>spatVectorCentroids</code> slot. The
<code><a href="../reference/centroids-generic.html">centroids()</a></code> generic from <em>terra</em> pulls from this
slot if the information already exists. Otherwise, it calculates and
returns a set of centroids for the polygons as <code>SpatVector</code>
points. The <code>append_gpolygon</code> param makes it so that the
<code>giottoPolygon</code> with the centroids info appended is returned
instead.</p>
</div>
<div class="section level2">
<h2 id="overlaps">6.1 Overlaps<a class="anchor" aria-label="anchor" href="#overlaps"></a>
</h2>
<p>Overlaps are sets of features overlapped by the polygons.
<code>calculateOverlaps()</code> is a generic function that performs
this overlapping between polygons and points and polygons and raster
(intensity) data.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gpoly</span><span class="op">@</span><span class="va">overlaps</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># reset overlaps info</span></span>
<span><span class="va">gpoly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateOverlap.html">calculateOverlap</a></span><span class="op">(</span><span class="va">gpoly</span>, <span class="va">gpoints</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gimg</span> <span class="op">&lt;-</span> <span class="fu">GiottoData</span><span class="fu">::</span><span class="fu"><a href="https://drieslab.github.io/GiottoData/reference/loadSubObjectMini.html" class="external-link">loadSubObjectMini</a></span><span class="op">(</span><span class="st">"giottoLargeImage"</span><span class="op">)</span></span>
<span><span class="va">gpoly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateOverlap.html">calculateOverlap</a></span><span class="op">(</span><span class="va">gpoly</span>, <span class="va">gimg</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Overlaps are stored as a <code>list</code> under the
<code>giottoPolygon</code> <code>overlaps</code> slot, separated by
modalities. This list can be retrieved using <code><a href="../reference/overlaps-generic.html">overlaps()</a></code>. In
the case of overlapped points geometries, the list items are points
<code>SpatVector</code> objects. The <code>poly_ID</code> column tracks
which polygon is overlapping the point feature as designated by
<code>feat_ID</code> and <code>feat_ID_uniq</code>. <code>NA</code>
values mean that the feature was not overlapped.</p>
<p>For overlaps intensities, the results are stored as
<code>data.tables</code> in a nested <code>list</code> called
<code>intensity</code> under the main <code>overlaps</code>
<code>list</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">@</span><span class="va">overlaps</span><span class="op">$</span><span class="va">rna</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : points </span></span>
<span><span class="co">##  dimensions  : 79761, 3  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 6400.037, 6900.032, -5149.983, -4699.979  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  coord. ref. :  </span></span>
<span><span class="co">##  names       : poly_ID feat_ID feat_ID_uniq</span></span>
<span><span class="co">##  type        :   &lt;chr&gt;   &lt;chr&gt;        &lt;int&gt;</span></span>
<span><span class="co">##  values      :      NA    Mlc1            1</span></span>
<span><span class="co">##                     NA  Gprc5b            2</span></span>
<span><span class="co">##                     NA    Gfap            3</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">@</span><span class="va">overlaps</span><span class="op">$</span><span class="va">intensity</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $dapi_z0</span></span>
<span><span class="co">##                                          poly_ID mini_dataset_dapi_z0</span></span>
<span><span class="co">##       1: 100210519278873141813371229408401071444                   18</span></span>
<span><span class="co">##       2: 100210519278873141813371229408401071444                   18</span></span>
<span><span class="co">##       3: 100210519278873141813371229408401071444                   18</span></span>
<span><span class="co">##       4: 100210519278873141813371229408401071444                   18</span></span>
<span><span class="co">##       5: 100210519278873141813371229408401071444                   18</span></span>
<span><span class="co">##      ---                                                             </span></span>
<span><span class="co">## 3170620:  98561957902191275233320065611022298397                   98</span></span>
<span><span class="co">## 3170621:  98561957902191275233320065611022298397                   98</span></span>
<span><span class="co">## 3170622:  98561957902191275233320065611022298397                   88</span></span>
<span><span class="co">## 3170623:  98561957902191275233320065611022298397                   88</span></span>
<span><span class="co">## 3170624:  98561957902191275233320065611022298397                   88</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="overlaps-to-matrix">6.2 Overlaps to matrix<a class="anchor" aria-label="anchor" href="#overlaps-to-matrix"></a>
</h2>
<p>Overlap results can be converted into expression matrices using
<code><a href="../reference/overlapToMatrix.html">overlapToMatrix()</a></code></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># points, rna modality (default)</span></span>
<span><span class="va">rna_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overlapToMatrix.html">overlapToMatrix</a></span><span class="op">(</span><span class="va">gpoly</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: [overlapToMatrix] expected col_names and row_names not provided together.</span></span>
<span><span class="co">##  Points aggregation Matrix output may be missing some cols and rows where no</span></span>
<span><span class="co">##  detections were found.</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rna_mat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 3 x 3 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">##       100210519278873141813371229408401071444</span></span>
<span><span class="co">## Abcc9                                       .</span></span>
<span><span class="co">## Ackr1                                       .</span></span>
<span><span class="co">## Ackr3                                       .</span></span>
<span><span class="co">##       101161259912191124732236989250178928032</span></span>
<span><span class="co">## Abcc9                                       .</span></span>
<span><span class="co">## Ackr1                                       .</span></span>
<span><span class="co">## Ackr3                                       .</span></span>
<span><span class="co">##       101488859781016188084173008420811094152</span></span>
<span><span class="co">## Abcc9                                       .</span></span>
<span><span class="co">## Ackr1                                       .</span></span>
<span><span class="co">## Ackr3                                       2</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># intensity, dapi_z0</span></span>
<span><span class="va">intens_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overlapToMatrix.html">overlapToMatrix</a></span><span class="op">(</span><span class="va">gpoly</span>, type <span class="op">=</span> <span class="st">"intensity"</span>, feat_info <span class="op">=</span> <span class="st">"dapi_z0"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">intens_mat</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 1 x 3 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">##                      100210519278873141813371229408401071444</span></span>
<span><span class="co">## mini_dataset_dapi_z0                                  519184</span></span>
<span><span class="co">##                      101161259912191124732236989250178928032</span></span>
<span><span class="co">## mini_dataset_dapi_z0                                  583988</span></span>
<span><span class="co">##                      101488859781016188084173008420811094152</span></span>
<span><span class="co">## mini_dataset_dapi_z0                                  613670</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] GiottoClass_0.1.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] sass_0.4.8           utf8_1.2.4           class_7.3-22        </span></span>
<span><span class="co">##  [4] KernSmooth_2.23-22   stringi_1.8.3        lattice_0.21-9      </span></span>
<span><span class="co">##  [7] digest_0.6.33        magrittr_2.0.3       evaluate_0.23       </span></span>
<span><span class="co">## [10] grid_4.3.2           fastmap_1.1.1        jsonlite_1.8.8      </span></span>
<span><span class="co">## [13] Matrix_1.6-4         e1071_1.7-14         backports_1.4.1     </span></span>
<span><span class="co">## [16] DBI_1.2.0            scattermore_1.2      GiottoData_0.2.6.2  </span></span>
<span><span class="co">## [19] purrr_1.0.2          fansi_1.0.6          scales_1.3.0        </span></span>
<span><span class="co">## [22] codetools_0.2-19     textshaping_0.3.7    jquerylib_0.1.4     </span></span>
<span><span class="co">## [25] cli_3.6.2            rlang_1.1.2          units_0.8-5         </span></span>
<span><span class="co">## [28] munsell_0.5.0        cachem_1.0.8         yaml_2.3.8          </span></span>
<span><span class="co">## [31] tools_4.3.2          raster_3.6-26        memoise_2.0.1       </span></span>
<span><span class="co">## [34] GiottoUtils_0.1.2    checkmate_2.3.1      colorspace_2.1-0    </span></span>
<span><span class="co">## [37] ggplot2_3.4.4        exactextractr_0.10.0 vctrs_0.6.5         </span></span>
<span><span class="co">## [40] R6_2.5.1             proxy_0.4-27         classInt_0.4-10     </span></span>
<span><span class="co">## [43] lifecycle_1.0.4      stringr_1.5.1        fs_1.6.3            </span></span>
<span><span class="co">## [46] ragg_1.2.7           pkgconfig_2.0.3      desc_1.4.3          </span></span>
<span><span class="co">## [49] pkgdown_2.0.7        terra_1.7-65         bslib_0.6.1         </span></span>
<span><span class="co">## [52] pillar_1.9.0         gtable_0.3.4         data.table_1.14.10  </span></span>
<span><span class="co">## [55] glue_1.6.2           Rcpp_1.0.11          sf_1.0-15           </span></span>
<span><span class="co">## [58] systemfonts_1.0.5    xfun_0.41            tibble_3.2.1        </span></span>
<span><span class="co">## [61] highr_0.10           knitr_1.45           htmltools_0.5.7     </span></span>
<span><span class="co">## [64] rmarkdown_2.25       compiler_4.3.2       sp_2.1-2</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.drieslab.com" class="external-link">Ruben Dries</a>, Jiaji George Chen, <a href="https://labs.icahn.mssm.edu/yuanlab/" class="external-link">Guo-Cheng Yuan</a>, Matthew O’Brien, <a href="https://josschavezf.github.io" class="external-link">Joselyn C. Chávez-Fuentes</a>, Edward Ruiz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
