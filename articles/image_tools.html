<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GiottoClass">
<title>Giotto image tools • GiottoClass</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/JetBrains_Mono-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Giotto image tools">
<meta property="og:description" content="GiottoClass">
<meta property="og:image" content="https://drieslab.github.io/GiottoClass/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GiottoClass</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Documentation</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/spatial_geometries.html">Spatial Geometry Objects</a>
    <a class="dropdown-item" href="../articles/image_tools.html">Images</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://drieslab.github.io/Giotto/">Suite</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/drieslab/GiottoClass/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Giotto image tools</h1>
            
      
      
      <div class="d-none name"><code>image_tools.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="giotto-image-tools">Giotto Image Tools<a class="anchor" aria-label="anchor" href="#giotto-image-tools"></a>
</h2>
<div class="section level3">
<h3 id="overview">1. Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>Giotto uses <code>giottoLargeImage</code> to represent images and
raster information. This is an S4 class built based on the
<em>terra</em> <code>SpatRaster</code>.</p>
<p>An older class called <code>giottoImage</code> based on the
<em>magick</em> package also exists, but is currently being phased out.
Ideally, <code>giottoLargeImages</code> will also be renamed to
<code>giottoImage</code> afterwards, simplifying the naming scheme.</p>
<p>The object structure of <code>giottoLargeImage</code></p>
<pre><code>giottoLargeImage
\- name                (object name)
\- raster_object       (terra raster object)
\- extent              (current spatial extent)
\- overall_extent      (spatial extent of original image - experimental)
\- scale_factor        (pixels per coordinate unit - experimental)
\- resolution          (coordinate units covered per pixel)
\- max_intensity       (approximate maximum intensity value)
\- min_intensity       (approximate minimum intensity value)
\- max_window          (value to set as maximum intensity in color scaling)
\- colors              (vector of color mappings provided as hex codes)
\- is_int              (whether values are integers)
\- file_path           (filepath to the image)
\- OS_platform         (operating system)</code></pre>
</div>
<div class="section level3">
<h3 id="sampling">2. Sampling<a class="anchor" aria-label="anchor" href="#sampling"></a>
</h3>
<p>Spatial images are often extremely large files. The high detail
(resolution), large spatial region captured, and precision of recorded
values (bitdepth) often results in files in the 10s of gigabytes. This
makes the full size images difficult to work with. One way to get around
this is to perform regular sampling of the image, touching only the
values of the original image that are needed generate a downscaled
representation. This is implemented in <em>terra</em> as
<code>spatSample()</code>.</p>
<p>When plotting, <em>Giotto</em> optimizes the speed of this sampling
by striking a balance between <code><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">terra::crop()</a></code> and
<code><a href="https://rdrr.io/pkg/terra/man/sample.html" class="external-link">terra::spatSample()</a></code> to try to prevent sampling from
unnecessary regions, but also avoid large crop operations on the
fullsize image, which can be very costly. This is done through
<code><a href="../reference/plot_auto_largeImage_resample.html">plot_auto_largeImage_resample()</a></code></p>
<p><code>giottoLargeImages</code> can also be resampled to other image
formats (<code>magick</code> and <code>EBImage</code>) in addition to
<code>data.table</code> and <code>array</code> using
<code>GiottoClass:::.spatraster_sample_values()</code></p>
<p>These two functions are experimental and they will be exported using
more common function names in the future.</p>
</div>
<div class="section level3">
<h3 id="color-scaling">3 Color scaling<a class="anchor" aria-label="anchor" href="#color-scaling"></a>
</h3>
<p><code><a href="../reference/distGiottoImage.html">distGiottoImage()</a></code> can be used to look at the values
present within a <code>giottoLargeImage</code>. It is often the case
that the values recorded within an image do not map to the full set of
values allowed by its bitdepth. <em>Giotto</em> plots images by guessing
the bitdepth based on the estimated maximum value detected. This mapping
may not always be optimal.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://drieslab.github.io/GiottoClass/">GiottoClass</a></span><span class="op">)</span></span>
<span><span class="va">gimg</span> <span class="op">&lt;-</span> <span class="fu">GiottoData</span><span class="fu">::</span><span class="fu"><a href="https://drieslab.github.io/GiottoData/reference/loadSubObjectMini.html" class="external-link">loadSubObjectMini</a></span><span class="op">(</span><span class="st">"giottoLargeImage"</span>, idx <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">gimg</span> <span class="op">&lt;-</span> <span class="fu">GiottoClass</span><span class="fu">:::</span><span class="fu">.update_giotto_image</span><span class="op">(</span><span class="va">gimg</span><span class="op">)</span> <span class="co"># update older images that are missing slots</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gimg</span><span class="op">)</span></span></code></pre></div>
<p><img src="image_tools_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distGiottoImage.html">distGiottoImage</a></span><span class="op">(</span>giottoLargeImage <span class="op">=</span> <span class="va">gimg</span><span class="op">)</span></span></code></pre></div>
<p><img src="image_tools_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
<p>Since there are few values beyond 70, try setting
<code>max_window</code> to 70 in so that the color mapping better
represents the available information.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gimg</span><span class="op">@</span><span class="va">max_window</span> <span class="op">&lt;-</span> <span class="fl">70</span></span>
<span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gimg</span><span class="op">)</span></span></code></pre></div>
<p><img src="image_tools_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot(gimg, max_intensity = 150) # can be used without setting the slot</span></span></code></pre></div>
<p>The colormap to use for an image can also be edited. The default for
a greyscale image is a monochrome black to white. Other color scales can
be supplied. For monochrome colorscales:
<code><a href="https://drieslab.github.io/Giotto/reference/getMonochromeColors.html" class="external-link">getMonochromeColors()</a></code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gimg</span><span class="op">@</span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://drieslab.github.io/Giotto/reference/getMonochromeColors.html" class="external-link">getMonochromeColors</a></span><span class="op">(</span><span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gimg</span><span class="op">)</span></span></code></pre></div>
<p><img src="image_tools_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">viridis_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">256</span>, palette <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot-generic.html">plot</a></span><span class="op">(</span><span class="va">gimg</span>, col <span class="op">=</span> <span class="va">viridis_colors</span><span class="op">)</span> <span class="co"># can be used without setting the slot</span></span></code></pre></div>
<p><img src="image_tools_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<div class="section level4">
<h4 id="todos">TODOs:<a class="anchor" aria-label="anchor" href="#todos"></a>
</h4>
<ul>
<li>provide accessors for these slots<br>
</li>
<li>make <em>ggplot</em>-based plotting also obey these settings</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] GiottoClass_0.1.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] Matrix_1.6-5       jsonlite_1.8.8     highr_0.10         compiler_4.3.2    </span></span>
<span><span class="co">##  [5] gtools_3.9.5       Rcpp_1.0.12        stringr_1.5.1      jquerylib_0.1.4   </span></span>
<span><span class="co">##  [9] systemfonts_1.0.5  textshaping_0.3.7  yaml_2.3.8         fastmap_1.1.1     </span></span>
<span><span class="co">## [13] lattice_0.21-9     R6_2.5.1           knitr_1.45         desc_1.4.3        </span></span>
<span><span class="co">## [17] bslib_0.6.1        GiottoUtils_0.1.3  rlang_1.1.3        cachem_1.0.8      </span></span>
<span><span class="co">## [21] stringi_1.8.3      terra_1.7-65       xfun_0.41          fs_1.6.3          </span></span>
<span><span class="co">## [25] sass_0.4.8         memoise_2.0.1      cli_3.6.2          pkgdown_2.0.7     </span></span>
<span><span class="co">## [29] magrittr_2.0.3     digest_0.6.34      grid_4.3.2         lifecycle_1.0.4   </span></span>
<span><span class="co">## [33] vctrs_0.6.5        evaluate_0.23      glue_1.7.0         data.table_1.14.10</span></span>
<span><span class="co">## [37] codetools_0.2-19   ragg_1.2.7         GiottoData_0.2.6.2 rmarkdown_2.25    </span></span>
<span><span class="co">## [41] purrr_1.0.2        tools_4.3.2        htmltools_0.5.7</span></span></code></pre>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.drieslab.com" class="external-link">Ruben Dries</a>, Jiaji George Chen, <a href="https://labs.icahn.mssm.edu/yuanlab/" class="external-link">Guo-Cheng Yuan</a>, Matthew O’Brien, <a href="https://josschavezf.github.io" class="external-link">Joselyn C. Chávez-Fuentes</a>, Edward Ruiz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
